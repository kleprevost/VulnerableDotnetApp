#!/bin/bash

function get_log(){
    curl -k -X GET https://rapid7test1.azurewebsites.net/SL/InsufficientLogging?showlogs 2>&1 \
        | sed "s/<\/br>/\n/g" | egrep ":\[(warn|info|error)\]"

}

OLDLOG=$(get_log)
./sensitive_data_exposure.sh
NEWLOG=$(get_log)

echo -e "log before breach is: \n$OLDLOG"
echo -e "log after breach is: \n$NEWLOG"

[ "$OLDLOG" == "$NEWLOG" ] && exit 0

exit 1
